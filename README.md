Apache 
===
[![Ansible Galaxy](https://img.shields.io/badge/ansible--galaxy-smbambling.apache-blue.svg)](https://galaxy.ansible.com/smbambling/apache/)
[![Build Status](https://travis-ci.org/smbambling/ansible-role-apache.svg?branch=master)](https://travis-ci.org/smbambling/ansible-role-apache)
[![CodeClimate](https://codeclimate.com/github/smbambling/ansible-role-apache/badges/gpa.svg)](https://codeclimate.com/github/smbambling/ansible-role-apache)
[![IssueCount](https://codeclimate.com/github/smbambling/ansible-role-apache/badges/issue_count.svg)](https://codeclimate.com/github/smbambling/ansible-role-apache)

Table of Contents
-----------------
1. [Overview](#overview)
1. [Requirements](#requirements)
1. [Variable Overrides](#variable-overrides)
1. [Role Variables](#role-variables)
1. [Dependencies](#dependencies)
1. [Examples](#example-playbooks)
1. [Development / Contributing](#development--contributing)
1. [License](#license)
1. [Author Information](#author-information)

Overview
--------
This role installs and manages the Apache HTTPD Web Server

Requirements
------------
This role requires Ansible 2.1 or higher and platform requirements are listed in the [metadata](meta/main.yml) file.

If you are using SSL/TLS you should provided your own certificate and key files.  By default it will use the localhost certificate and key created by the system.

Variable Overrides
------------------

Varibles listed as a key with no values in `defaults/main.yml` can be overriden via group or extra variables yet still set a default value via OS-specific variable includes ( see `vars/*.yml` ).

This is accomplished via the `set_overrides.yml` task file which determines if a value is passed to the role or if the value is `None` and then initializes the variable with a default value from the OS-specific variable includes

Role Variables
--------------
The variables that can be passed to this role and a brief description about them are as follows. (For all variables, take a look at defaults/main.yml)

> See [Variable Overrides](#variable-overrides) for information on variables not listed with a default value and the ability to override them via pass-ins.

```yaml
apache_packages:
```
The set of packages to be installed. 

```yaml
apache_service:
```
The service name for the apache daemon to run on the system.

```yaml
apache_state:
```
The Apache daemon state to be enforced. This should generally remain the default value.

```yaml
apache_enabled:
```
Weather the apache service should start on boot. This should generally remain the default value.

## Modules

### Status ( mod_status )

```yaml
apache_mod_status_manage: True
```
Enable management of the Apache status module configuration.

```yaml
apache_mod_status_allow_from:
  - 127.0.0.1
  - ::1
```
Array of hosts allowed to access the Apache status page.  Defaults to localhost via IPv4 and IPv6

### VirtualHosts

### Virtualhost Dict Keys: Defaults

All default Apache VirtualHost entries are removed during the running of this play and declaired VirtualHosts are generated. Overridden inside the `apache_vhosts` variable on a per Virtualhost basis within the dict.

```yaml
apache_vhosts_template: vhostsj2
```
```yaml
apache_vhosts:
  - server_name: "example.mysite.com"
    template: "../path/to/custom/template"
```
The template used for generating VirtualHost configurations. This can be used to call a custom template if desired per VirtualHost. Overridden inside the `apache_vhosts` variable on a per Virtualhost basis within the dict.

 ```yaml
 apache_vhost_ssl: True
 ```
Enables/Disables SSL for the virtual host. SSL virtual hosts only respond to HTTPS queries.  Defaults to True, SSL should be used everywhere!! Overridden inside the `apache_vhosts` variable on a per Virtualhost basis within the dict.

```yaml
apache_ssl_certs_dir:
```
The directory containing Certificates of Certification Authorities (CAs), used for SSl/TLS configuration. This should generally remain the default value. Overridden inside the `apache_vhosts` variable on a per Virtualhost basis within the dict.

```yaml
apache_ssl_default_cert:
```
The PEM-encoded certificate file, used for SSL/TLS configuration. Defaults are based on local certificate generated by your OS. Overridden inside the `apache_vhosts` variable on a per Virtualhost basis within the dict.

```yaml
apache_ssl_default_key:
```
The PEM-encoded private key file, used for SSL/TLS configuration. Defaults are based on local certificate generated by your OS. Overridden inside the `apache_vhosts` variable on a per Virtualhost basis within the dict.

```yaml
apache_vhost_ip: '*'
```
IP address the virtual host listens on.  Default behavior of listening on all IPs. Overridden inside the `apache_vhosts` variable on a per Virtualhost basis within the dict.

```yaml
apache_vhost_port: '443'
```
Port the Virtualhost is configured to listen on.  Defaults to 443. Overridden inside the `apache_vhosts` variable on a per Virtualhost basis within the dict.

### Virtualhost Dict Keys

```yaml
apache_vhosts:
  - server_name: 'site.example.com'
```
Sets the servername corresponding to the hostname you connect to the Virtualhost at. Sets the Apache ServerName directive. Default: undef

```yaml
apache_vhosts:
  - serveraliases:
      - 'site.example.org'
      - 'site.example.net'
```
List of server aliases for the Virtualhost. Sets the ServerAlias Directive. Default: undef

```yaml
apache_vhosts:
  - server_admin 'admin@example.com'
```
Specifies the email address Apache displays when it renders one of its error pages. Default: undef

```yaml
apache_vhosts:
  - virtual_docroot: '/var/www/%-2+'
```
Sets the VirtualDocumentRoot directive to allow you to determine where Apache HTTP Server will find your documents based on the value of the server name. Default: undef

```yaml
apache_vhosts:
  - docroot: '/var/www/html'
```
Sets the default DocumentRoot location for a VritualHost.  Default: undef

```yaml
apache_vhosts:
  - aliases:
      - alias: '/image'
        path: '/ftp/pub/image'
      - aliasmatch: '^/image/(.*)\.jpg$'
        path: '/files/jpg.images/$1.jpg'
      - scriptalias: '/nagios/cgi-bin/'
        path: '/usr/lib/nagios/cgi-bin/'
      - scriptaliasmatch: '^/cgi-bin(.*)'
        path: '/usr/local/share/cgi-bin$1'
```

A list of hashes to create **Alias**, **AliasMatch**, **ScriptAlias** or **ScriptAliasMatch** directives. Default: undef

```yaml
apache_vhosts:
  - fallbackresource: '/index.php'
```
Sets the FallbackResource directive, which specifies an action to take for any URL that doesn't map to anything in your filesystem and would otherwise return 'HTTP 404 (Not Found)'. Valid options must either begin with a '/' or be 'disabled'. Default: undef

```yaml
apache_vhosts:
  - port: 80
```
Overrides the port the Virtualhost is configured to listen.  Default: See `apache_vhost_port`

```yaml
apache_vhosts:
  - ssl: False
```
Enables/Disables SSL for the virtual host. SSL virtual hosts only respond to HTTPS queries. Default: See `apache_vhost_ssl`



Dependencies
------------
None

Example Playbook(s)
-------------------

1. Use Virtualhost default configurations from `defaults/main.yml`

  ```yaml
  ---
  roles:
    - role: ansible-role-apache
  ```

1. Set custom Virtualhost entries via Playbook variables

  ```yaml
  ---
  vars:
    apache_vhosts:
      - server_name: site.example.com
        serveraliases:
          - site.example.org
          - site.example.net
        port: 80
        ssl: False
        docroot: '/var/www/site_com'

  roles:
    - role: ansible-role-apache
  ```

1. Set custom entries via [Group Variables](http://docs.ansible.com/ansible/intro_inventory.html#group-variables)
  
  ```yaml
  group_vars/web1.example.dev/apache.yml
  
  ---
  apache_vhosts:
      - server_name: site.example.com
        serveraliases:
          - site.example.org
          - site.example.net
        port: 80
        ssl: False
        docroot: '/var/www/site_com'
  ```
  ```yaml
  ---
  roles:
    - role: ansible-role-apache
  ```

Development / Contributing
--------------------------
See [Contributing](.github/CONTRIBUTING.md).

Note: This role is currently only tested against the following OS and Ansible versions:

#### Operating Systems / version
- CentOS 6.x
- CentOS 7.x

#### Ansible Versions
- 2.2.2
- latest

License
-------
Licensed under the MIT License. See the [LICENSE](./LICENSE) file for details.

Author Information
------------------
- Steven Bambling
