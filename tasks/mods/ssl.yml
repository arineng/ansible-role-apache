---
- name: Set fact apache_package_mod_ssl
  set_fact:
    apache_package_mod_ssl: "{{ _apache_package_mod_ssl }}"
  when: apache_package_mod_ssl is none

- name: Install Apache module mod_ssl
  package:
    name: "{{ apache_package_mod_ssl }}"
    state: present

- name: Load SSL Apache modules
  include: load.yml
  with_items:
    - ssl

- name: Load SSL Apache 2.4 modules
  include: load.yml
  with_items:
    - socache_shmcb
  when: apache_version == '2.4'

- name: Configure Apache module mod_ssl
  template:
    src: "{{ apache_mod_ssl_template }}"
    dest: "{{ apache_mod_dir }}/ssl.conf"
    owner: root
    group: root
    setype: httpd_config_t
    mode: '0644'
  notify: Test and Restart Apache
